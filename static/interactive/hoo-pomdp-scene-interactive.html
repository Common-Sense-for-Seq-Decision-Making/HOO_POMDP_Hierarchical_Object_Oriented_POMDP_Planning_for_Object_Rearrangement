<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOO-POMDP: Interactive Scene Visualization</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            width: 100%;
        }

        .title {
            text-align: center;
            font-size: 1.6em;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 0.95em;
            margin-bottom: 20px;
        }

        /* Scene container */
        .scene-container {
            position: relative;
            max-width: 900px;
            margin: 0 auto 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            overflow: hidden;
        }

        .scene-container img {
            width: 100%;
            display: block;
        }

        /* SVG overlay */
        .scene-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .hotspot {
            pointer-events: all;
            cursor: pointer;
        }

        .hotspot circle {
            transition: all 0.3s ease;
        }

        .hotspot:hover circle,
        .hotspot.active circle {
            fill-opacity: 0.6;
            stroke-width: 5;
            filter: drop-shadow(0 0 12px currentColor);
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        .pulse-ring {
            animation: pulse 2s infinite;
        }

        .hotspot.active .pulse-ring {
            animation: none;
        }

        /* Info panel */
        .info-panel {
            position: absolute;
            bottom: 15px;
            left: 15px;
            right: 15px;
            background: rgba(255,255,255,0.97);
            border-radius: 10px;
            padding: 18px 22px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.2);
            border-left: 5px solid #3273dc;
            transform: translateY(10px);
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .info-panel.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .info-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .info-row {
            display: flex;
            margin: 6px 0;
            font-size: 0.9em;
        }

        .info-label {
            font-weight: 600;
            color: #555;
            min-width: 100px;
        }

        .info-value {
            color: #333;
        }

        .status-blocked { color: #d32f2f; font-weight: 600; }
        .status-congested { color: #ff9800; font-weight: 600; }
        .status-reachable { color: #4caf50; font-weight: 600; }

        .order-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.85em;
        }

        .order-1 { background: #ffeb3b; color: #333; }
        .order-2 { background: #ab47bc; color: white; }
        .order-3 { background: #42a5f5; color: white; }
        .order-flex { background: #78909c; color: white; }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .demo-btn {
            padding: 10px 24px;
            font-size: 0.95em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .demo-btn.primary {
            background: linear-gradient(135deg, #5b6abf 0%, #7c4dff 100%);
            color: white;
        }

        .demo-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(91,106,191,0.4);
        }

        .demo-btn.primary.active {
            background: linear-gradient(135deg, #e63946 0%, #ff6b6b 100%);
        }

        .demo-btn.secondary {
            background: #e0e0e0;
            color: #333;
        }

        .demo-btn.secondary:hover {
            background: #d0d0d0;
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.82em;
            color: #555;
        }

        .legend-line {
            width: 20px;
            height: 4px;
            border-radius: 2px;
        }

        .legend-box {
            width: 14px;
            height: 14px;
            border: 2px dashed #666;
        }

        /* Planning sequence */
        .planning-sequence {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 18px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
        }

        .sequence-title {
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 12px;
            font-size: 0.9em;
        }

        .sequence-steps {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .sequence-step {
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.3s;
        }

        .sequence-step.active {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .sequence-arrow {
            color: #888;
            font-size: 1.2em;
        }

        .step-1 { background: #ffeb3b; color: #333; }
        .step-2 { background: #ab47bc; color: white; }
        .step-3 { background: #42a5f5; color: white; }
        .step-4 { background: #78909c; color: white; }

        .sequence-note {
            font-size: 0.8em;
            color: #555;
            margin-top: 10px;
        }

        /* Instructions */
        .instructions {
            text-align: center;
            color: #888;
            font-size: 0.85em;
            font-style: italic;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="title">HOO-POMDP: Interactive Multi-Object Rearrangement</h1>
    <p class="subtitle">Explore how hierarchical planning solves blocked path dependencies. Hover over objects or start auto-demo.</p>

    <div class="controls">
        <button class="demo-btn primary" id="autoDemo">Start Auto Demo</button>
        <button class="demo-btn secondary" id="resetBtn">Reset</button>
    </div>

    <div class="scene-container">
        <img src="../../resources/hoo_pomdp_example.png" alt="HOO-POMDP Multi-room Scene">

        <svg class="scene-svg" viewBox="0 0 960 620">
            <!-- Object 1 hotspot (blue label "1", dining room on right) -->
            <g class="hotspot" data-obj="1">
                <circle cx="700" cy="68" r="24" fill="rgba(0,128,255,0.15)" stroke="#00aaff" stroke-width="3" class="pulse-ring"/>
            </g>

            <!-- Object 2 hotspot (pink label "2", far right side) -->
            <g class="hotspot" data-obj="2">
                <circle cx="905" cy="285" r="24" fill="rgba(255,0,255,0.15)" stroke="#ff00ff" stroke-width="3" class="pulse-ring"/>
            </g>

            <!-- Object 3 hotspot (yellow label "3" with red box, on couch) -->
            <g class="hotspot" data-obj="3">
                <circle cx="595" cy="290" r="24" fill="rgba(255,255,0,0.2)" stroke="#ffff00" stroke-width="3" class="pulse-ring"/>
            </g>

            <!-- Object 4 hotspot (cyan label "4", kitchen area) -->
            <g class="hotspot" data-obj="4">
                <circle cx="488" cy="72" r="24" fill="rgba(0,255,255,0.15)" stroke="#00ffff" stroke-width="3" class="pulse-ring"/>
            </g>

            <!-- Object 5 hotspot (yellow label "5", bedroom left lower) -->
            <g class="hotspot" data-obj="5">
                <circle cx="88" cy="178" r="24" fill="rgba(255,255,0,0.2)" stroke="#ffff00" stroke-width="3" class="pulse-ring"/>
            </g>

            <!-- Object 6 hotspot (yellow label "6", bedroom upper near door) -->
            <g class="hotspot" data-obj="6">
                <circle cx="82" cy="100" r="24" fill="rgba(255,255,0,0.2)" stroke="#ffff00" stroke-width="3" class="pulse-ring"/>
            </g>
        </svg>

        <div class="info-panel" id="infoPanel">
            <div id="infoContent"></div>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item"><div class="legend-line" style="background:#00ff00;"></div>Object 1 & 2 paths</div>
        <div class="legend-item"><div class="legend-line" style="background:#00ffff;"></div>Object 4 path</div>
        <div class="legend-item"><div class="legend-line" style="background:#ff00ff;"></div>Object 6 path</div>
        <div class="legend-item"><div class="legend-line" style="background:#ffff00;"></div>Shared corridor</div>
        <div class="legend-item"><div class="legend-line" style="background:#ff0000;"></div>Object 3 (blocked)</div>
        <div class="legend-item"><div class="legend-box"></div>Goal location</div>
    </div>

    <div class="planning-sequence">
        <div class="sequence-title">HOO-POMDP Computed Optimal Execution Sequence</div>
        <div class="sequence-steps">
            <span class="sequence-step step-1" id="step1">1. Move Object 3</span>
            <span class="sequence-arrow">→</span>
            <span class="sequence-step step-2" id="step2">2. Move Object 2</span>
            <span class="sequence-arrow">→</span>
            <span class="sequence-step step-3" id="step3">3. Move Object 1</span>
            <span class="sequence-arrow">→</span>
            <span class="sequence-step step-4" id="step4">4. Remaining Objects</span>
        </div>
        <div class="sequence-note">
            Object 3 blocks Object 1's goal location. Object 2 congests the corridor. The planner discovers this dependency chain automatically.
        </div>
    </div>

    <p class="instructions">Hover over objects to explore dependencies. Use "Start Auto Demo" for video recording.</p>
</div>

<script>
(function() {
    var objectInfo = {
        '1': {
            title: 'Object 1 (Blue mug)',
            path: 'Green path',
            statusClass: 'status-blocked',
            status: 'BLOCKED',
            dependency: 'Object 3 is sitting at this object\'s goal location (red dashed square on couch)',
            solution: 'Must wait for Object 3 to be moved first',
            orderClass: 'order-3',
            order: '3rd in sequence',
            step: 3
        },
        '2': {
            title: 'Object 2 (Pink marker)',
            path: 'Green path',
            statusClass: 'status-congested',
            status: 'PATH CONGESTED',
            dependency: 'Shares the main corridor with multiple objects. Yellow dotted path through hallway is busy.',
            solution: 'Move after Object 3 clears the critical blocker',
            orderClass: 'order-2',
            order: '2nd in sequence',
            step: 2
        },
        '3': {
            title: 'Object 3 (Yellow, on couch)',
            path: 'Red path (blocked)',
            statusClass: 'status-blocked',
            status: 'CRITICAL BLOCKER',
            dependency: 'This object is sitting directly at Object 1\'s goal location!',
            solution: 'MUST be moved FIRST to free up Object 1\'s goal',
            orderClass: 'order-1',
            order: 'PRIORITY - 1st',
            step: 1
        },
        '4': {
            title: 'Object 4 (Cyan, kitchen)',
            path: 'Cyan path',
            statusClass: 'status-reachable',
            status: 'REACHABLE',
            dependency: 'No blocking dependencies. Clear path to goal location.',
            solution: 'Can be moved independently after priority objects',
            orderClass: 'order-flex',
            order: 'Flexible',
            step: 4
        },
        '5': {
            title: 'Object 5 (Yellow, bedroom)',
            path: 'Yellow/Pink path',
            statusClass: 'status-reachable',
            status: 'REACHABLE',
            dependency: 'No direct blocking dependencies.',
            solution: 'Move after corridor congestion clears',
            orderClass: 'order-flex',
            order: 'Flexible',
            step: 4
        },
        '6': {
            title: 'Object 6 (Magenta path)',
            path: 'Magenta path',
            statusClass: 'status-reachable',
            status: 'REACHABLE',
            dependency: 'No blocking dependencies. Located near bedroom doorway.',
            solution: 'Can be moved when corridor becomes available',
            orderClass: 'order-flex',
            order: 'Flexible',
            step: 4
        }
    };

    var infoPanel = document.getElementById('infoPanel');
    var infoContent = document.getElementById('infoContent');
    var hotspots = document.querySelectorAll('.hotspot');
    var autoBtn = document.getElementById('autoDemo');
    var resetBtn = document.getElementById('resetBtn');
    var steps = [
        document.getElementById('step1'),
        document.getElementById('step2'),
        document.getElementById('step3'),
        document.getElementById('step4')
    ];

    var demoInterval = null;
    var demoRunning = false;

    function showInfo(objId) {
        var info = objectInfo[objId];
        if (!info) return;

        infoContent.innerHTML =
            '<div class="info-title">' + info.title + ' <span style="font-weight:400; color:#888;">(' + info.path + ')</span></div>' +
            '<div class="info-row"><span class="info-label">Status:</span><span class="info-value ' + info.statusClass + '">' + info.status + '</span></div>' +
            '<div class="info-row"><span class="info-label">Dependency:</span><span class="info-value">' + info.dependency + '</span></div>' +
            '<div class="info-row"><span class="info-label">Solution:</span><span class="info-value">' + info.solution + '</span></div>' +
            '<div class="info-row"><span class="info-label">Order:</span><span class="info-value"><span class="order-badge ' + info.orderClass + '">' + info.order + '</span></span></div>';

        infoPanel.classList.add('visible');

        // Highlight corresponding step
        steps.forEach(function(s, i) {
            s.classList.remove('active');
            if (i + 1 === info.step || (info.step === 4 && i === 3)) {
                s.classList.add('active');
            }
        });
    }

    function hideInfo() {
        infoPanel.classList.remove('visible');
        steps.forEach(function(s) { s.classList.remove('active'); });
    }

    function activateHotspot(objId) {
        hotspots.forEach(function(h) {
            h.classList.remove('active');
            if (h.dataset.obj === objId) {
                h.classList.add('active');
            }
        });
        showInfo(objId);
    }

    function deactivateAll() {
        hotspots.forEach(function(h) { h.classList.remove('active'); });
        hideInfo();
    }

    // Mouse events
    hotspots.forEach(function(h) {
        h.addEventListener('mouseenter', function() {
            if (!demoRunning) {
                activateHotspot(h.dataset.obj);
            }
        });
        h.addEventListener('mouseleave', function() {
            if (!demoRunning) {
                deactivateAll();
            }
        });
    });

    // Auto demo
    var demoSequence = ['3', '2', '1', '4', '5', '6'];
    var demoIndex = 0;

    function runDemo() {
        if (demoIndex >= demoSequence.length) {
            demoIndex = 0;
        }
        activateHotspot(demoSequence[demoIndex]);
        demoIndex++;
    }

    autoBtn.addEventListener('click', function() {
        if (demoRunning) {
            // Stop demo
            clearInterval(demoInterval);
            demoRunning = false;
            demoIndex = 0;
            autoBtn.textContent = 'Start Auto Demo';
            autoBtn.classList.remove('active');
            deactivateAll();
        } else {
            // Start demo
            demoRunning = true;
            autoBtn.textContent = 'Stop Demo';
            autoBtn.classList.add('active');
            runDemo();
            demoInterval = setInterval(runDemo, 3000);
        }
    });

    resetBtn.addEventListener('click', function() {
        if (demoRunning) {
            clearInterval(demoInterval);
            demoRunning = false;
            autoBtn.textContent = 'Start Auto Demo';
            autoBtn.classList.remove('active');
        }
        demoIndex = 0;
        deactivateAll();
    });
})();
</script>

</body>
</html>
